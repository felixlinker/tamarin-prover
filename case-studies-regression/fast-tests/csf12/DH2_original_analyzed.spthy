theory DH2_original begin

// Function signature and definition of the equational theory E

builtins: diffie-hellman
functions: KDF/1, MAC/2, fst/1, h/1, pair/2, snd/1
equations: fst(<x.1, x.2>) = x.1, snd(<x.1, x.2>) = x.2









section{* DH2 *}

rule (modulo E) Register_pk:
   [ Fr( ~ltkA ) ]
  -->
   [ !Ltk( $A, ~ltkA ), !Pk( $A, 'g'^~ltkA ), Out( 'g'^~ltkA ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Init_1:
   [ Fr( ~m1 ), !Ltk( $I, ~ltkI ), !Pk( $R, 'g'^~ltkR ) ]
  --[
  Sid( ~m1, $I, $R, <$I, $R, 'Init', 'g'^~ltkR^~m1> ), EphKey( ~m1, ~m1 )
  ]->
   [
   Init_1( ~m1, $I, $R, ~ltkI, 'g'^~m1, 'g'^~ltkR^~m1 ), !Ephk( ~m1, ~m1 ),
   Out( 'g'^~ltkR^~m1 )
   ]

  /*
  rule (modulo AC) Init_1:
     [ Fr( ~m1 ), !Ltk( $I, ~ltkI ), !Pk( $R, 'g'^~ltkR ) ]
    --[
    Sid( ~m1, $I, $R, <$I, $R, 'Init', 'g'^(~ltkR*~m1)> ), EphKey( ~m1, ~m1 )
    ]->
     [
     Init_1( ~m1, $I, $R, ~ltkI, 'g'^~m1, 'g'^(~ltkR*~m1) ),
     !Ephk( ~m1, ~m1 ), Out( 'g'^(~ltkR*~m1) )
     ]
  */

rule (modulo E) Resp_1:
   [ Fr( ~m2 ), In( XB ), !Ltk( $R, ~ltkR ), !Pk( $I, 'g'^~ltkI ) ]
  --[
  Sid( ~m2, $R, $I, <$R, $I, 'Resp', 'g'^~ltkI^~m2, XB> ),
  Match( ~m2, <$I, $R, 'Init', XB> ), EphKey( ~m2, ~m2 )
  ]->
   [
   Resp_1( ~m2, $I, $R, 'g'^~ltkI^~m2, XB,
           MAC(KDF(<XB^inv(~ltkR), 'g'^~m2, $I, $R, XB, 'g'^~ltkI^~m2>),
               <'Init', $I, $R, XB, 'g'^~ltkI^~m2>),
           KDF(<XB^inv(~ltkR), 'g'^~m2, $I, $R, XB, 'g'^~ltkI^~m2>)
   ),
   !Ephk( ~m2, ~m2 ),
   Out( <'g'^~ltkI^~m2, 
         MAC(KDF(<XB^inv(~ltkR), 'g'^~m2, $I, $R, XB, 'g'^~ltkI^~m2>),
             <'Resp', $R, $I, 'g'^~ltkI^~m2, XB>)
        >
   )
   ]

  /*
  rule (modulo AC) Resp_1:
     [ Fr( ~m2 ), In( XB ), !Ltk( $R, ~ltkR ), !Pk( $I, 'g'^~x ) ]
    --[
    Sid( ~m2, $R, $I, <$R, $I, 'Resp', 'g'^(~m2*~x), XB> ),
    Match( ~m2, <$I, $R, 'Init', XB> ), EphKey( ~m2, ~m2 )
    ]->
     [
     Resp_1( ~m2, $I, $R, 'g'^(~m2*~x), XB,
             MAC(KDF(<z, 'g'^~m2, $I, $R, XB, 'g'^(~m2*~x)>),
                 <'Init', $I, $R, XB, 'g'^(~m2*~x)>),
             KDF(<z, 'g'^~m2, $I, $R, XB, 'g'^(~m2*~x)>)
     ),
     !Ephk( ~m2, ~m2 ),
     Out( <'g'^(~m2*~x), 
           MAC(KDF(<z, 'g'^~m2, $I, $R, XB, 'g'^(~m2*~x)>),
               <'Resp', $R, $I, 'g'^(~m2*~x), XB>)
          >
     )
     ]
    variants (modulo AC)
    1. ~ltkR = ~ltkR.3
       XB    = XB.3
       z     = XB.3^inv(~ltkR.3)
    
    2. ~ltkR = ~ltkR.3
       XB    = x.13^x.14
       z     = x.13^(x.14*inv(~ltkR.3))
    
    3. ~ltkR = ~ltkR.3
       XB    = x.13^inv(x.14)
       z     = x.13^inv((~ltkR.3*x.14))
    
    4. ~ltkR = ~ltkR.3
       XB    = x.14^(x.15*inv(x.16))
       z     = x.14^(x.15*inv((~ltkR.3*x.16)))
    
    5. ~ltkR = ~x.14
       XB    = x.16^~x.14
       z     = x.16
    
    6. ~ltkR = ~x.15
       XB    = x.17^(~x.15*x.18)
       z     = x.17^x.18
    
    7. XB    = DH_neutral
       z     = DH_neutral
  */

rule (modulo E) Init_2:
   [
   Init_1( ~m1, $I, $R, ~ltkI, X, XB ),
   In( <YA, 
        MAC(KDF(<X, YA^inv(~ltkI), $I, $R, XB, YA>), <'Resp', $R, $I, YA, XB>)>
   )
   ]
  --[
  Sid( ~m1, $I, $R, <$I, $R, 'Init', XB, YA> ),
  Match( ~m1, <$R, $I, 'Resp', YA, XB> ),
  Accept( ~m1, $I, $R, KDF(<X, YA^inv(~ltkI), $I, $R, XB, YA>) )
  ]->
   [
   Out( <YA, XB, 
         MAC(KDF(<X, YA^inv(~ltkI), $I, $R, XB, YA>), <'Init', $I, $R, XB, YA>)>
   ),
   !Sessk( ~m1, KDF(<X, YA^inv(~ltkI), $I, $R, XB, YA>) )
   ]

  /*
  rule (modulo AC) Init_2:
     [
     Init_1( ~m1, $I, $R, ~ltkI, X, XB ),
     In( <YA, MAC(KDF(<X, z, $I, $R, XB, YA>), <'Resp', $R, $I, YA, XB>)> )
     ]
    --[
    Sid( ~m1, $I, $R, <$I, $R, 'Init', XB, YA> ),
    Match( ~m1, <$R, $I, 'Resp', YA, XB> ),
    Accept( ~m1, $I, $R, KDF(<X, z, $I, $R, XB, YA>) )
    ]->
     [
     Out( <YA, XB, MAC(KDF(<X, z, $I, $R, XB, YA>), <'Init', $I, $R, XB, YA>)>
     ),
     !Sessk( ~m1, KDF(<X, z, $I, $R, XB, YA>) )
     ]
    variants (modulo AC)
    1. ~ltkI = ~x.5
       YA    = x.9^~x.5
       z     = x.9
    
    2. YA    = DH_neutral
       z     = DH_neutral
    
    3. ~ltkI = ~ltkI.3
       YA    = x.2^inv(x.3)
       z     = x.2^inv((~ltkI.3*x.3))
    
    4. ~ltkI = ~ltkI.3
       YA    = x.2^x.3
       z     = x.2^(x.3*inv(~ltkI.3))
    
    5. ~ltkI = ~ltkI.3
       YA    = YA.3
       z     = YA.3^inv(~ltkI.3)
    
    6. ~ltkI = ~ltkI.3
       YA    = x.3^(x.4*inv(x.5))
       z     = x.3^(x.4*inv((~ltkI.3*x.5)))
    
    7. ~ltkI = ~x.6
       YA    = x.10^(~x.6*x.11)
       z     = x.10^x.11
  */

rule (modulo E) Resp_2:
   [ Resp_1( ~m2, $I, $R, YA, XB, tagA, key ), In( <YA, XB, tagA> ) ]
  --[ Accept( ~m2, $R, $I, key ) ]->
   [ !Sessk( ~m2, key ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Sessk_reveal:
   [ !Sessk( ~tid, k ) ] --[ SesskRev( ~tid ) ]-> [ Out( k ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Ltk_reveal:
   [ !Ltk( $A, lkA ) ] --[ LtkRev( $A ) ]-> [ Out( lkA ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Ephk_reveal:
   [ !Ephk( ~s, ~ek ) ] --[ EphkRev( ~s ) ]-> [ Out( ~ek ) ]

  /* has exactly the trivial AC variant */

lemma KAS_key_secrecy:
  all-traces
  "¬(∃ #i1 #i2 s A B k.
      ((((Accept( s, A, B, k ) @ #i1) ∧ (K( k ) @ #i2)) ∧
        (¬(∃ #i4. SesskRev( s ) @ #i4))) ∧
       (∀ ss #i4 #i5 C D ms.
         ((Sid( ss, C, D, ms ) @ #i4) ∧ (Match( s, ms ) @ #i5)) ⇒
         (((((¬(∃ #i6. SesskRev( ss ) @ #i6)) ∧
             (¬(∃ #i6 #i7. (LtkRev( A ) @ #i6) ∧ (EphkRev( s ) @ #i7)))) ∧
            (¬(∃ #i6 #i7. (LtkRev( B ) @ #i6) ∧ (EphkRev( ss ) @ #i7)))) ∧
           (¬(∃ #i6 #i7. (LtkRev( A ) @ #i6) ∧ (LtkRev( B ) @ #i7)))) ∧
          (¬(∃ #i6 #i7. (EphkRev( s ) @ #i6) ∧ (EphkRev( ss ) @ #i7)))))) ∧
      ((¬(∃ ss #i4 #i5 C D ms.
           (Sid( ss, C, D, ms ) @ #i4) ∧ (Match( s, ms ) @ #i5))) ⇒
       ((¬(∃ #i6. EphkRev( s ) @ #i6)) ∧
        (¬(∃ #i6. (LtkRev( B ) @ #i6) ∧ (#i6 < #i1))))))"
/*
guarded formula characterizing all counter-examples:
"∃ #i1 #i2 s A B k.
  (Accept( s, A, B, k ) @ #i1) ∧ (K( k ) @ #i2)
 ∧
  (∀ #i4. (SesskRev( s ) @ #i4) ⇒ ⊥) ∧
  (∀ ss #i4 #i5 C D ms.
    (Sid( ss, C, D, ms ) @ #i4) ∧ (Match( s, ms ) @ #i5)
   ⇒
    (∀ #i6. (SesskRev( ss ) @ #i6) ⇒ ⊥) ∧
    (∀ #i6 #i7. (LtkRev( A ) @ #i6) ∧ (EphkRev( s ) @ #i7) ⇒ ⊥) ∧
    (∀ #i6 #i7. (LtkRev( B ) @ #i6) ∧ (EphkRev( ss ) @ #i7) ⇒ ⊥) ∧
    (∀ #i6 #i7. (LtkRev( A ) @ #i6) ∧ (LtkRev( B ) @ #i7) ⇒ ⊥) ∧
    (∀ #i6 #i7. (EphkRev( s ) @ #i6) ∧ (EphkRev( ss ) @ #i7) ⇒ ⊥)) ∧
  (((∃ ss #i4 #i5 C D ms.
      (Sid( ss, C, D, ms ) @ #i4) ∧ (Match( s, ms ) @ #i5)) ∨
    ((∀ #i6. (EphkRev( s ) @ #i6) ⇒ ⊥) ∧
     (∀ #i6. (LtkRev( B ) @ #i6) ⇒ ¬(#i6 < #i1)))))"
*/
simplify
solve( (∃ ss #i4 #i5 C D ms.
         (Sid( ss, C, D, ms ) @ #i4) ∧ (Match( s, ms ) @ #i5))  ∥
       ((∀ #i6. (EphkRev( s ) @ #i6) ⇒ ⊥) ∧
        (∀ #i6. (LtkRev( B ) @ #i6) ⇒ ¬(#i6 < #i1))) )
  case case_1
  solve( Accept( s, A, B, x ) @ #i1 )
    case Init_2
    solve( Init_1( ~m1, $I, $R, ~ltkI, X, XB ) ▶₀ #i1 )
      case Init_1
      solve( Sid( ss, C, D, ms ) @ #i4 )
        case Init_1
        solve( !Ltk( $I.1, ~ltkI.1 ) ▶₁ #i4 )
          case Register_pk
          solve( !Pk( $R.1, 'g'^~ltkR.1 ) ▶₂ #i4 )
            case Register_pk
            by solve( Match( ~m1, <$I.1, $R.1, 'Init', 'g'^(~ltkR.1*~m1.1)> ) @ #i5 )
          qed
        qed
      next
        case Init_2
        solve( Init_1( ~m1.1, $I.1, $R.1, ~ltkI.1, X.1, XB.1 ) ▶₀ #i4 )
          case Init_1
          by solve( Match( ~m1, <$I.1, $R.1, 'Init', 'g'^(~ltkR.1*~m1.1), YA.1>
                    ) @ #i5 )
        qed
      next
        case Resp_1
        solve( !Ltk( $R.1, ~ltkR.1 ) ▶₂ #i4 )
          case Register_pk
          solve( !Pk( $I.1, 'g'^~x.1 ) ▶₃ #i4 )
            case Register_pk
            solve( Match( ~m1, <$R.1, $I.1, 'Resp', 'g'^(~m2*~x.1), XB.1> ) @ #i5 )
              case Init_2
              solve( Init_1( ~m1.1, $I.2, $R.2, ~ltkI.1, X.1, XB.2 ) ▶₀ #i5 )
                case Init_1
                solve( splitEqs(0) )
                  case split_case_1
                  solve( splitEqs(1) )
                    case split_case_1
                    solve( !KU( MAC(KDF(<'g'^~m1.2, 'g'^(~m2.1*~x.6*inv(~ltkI.2)), $I.2, 
                                         $R.2, 'g'^(~m1.2*~ltkR.4), 'g'^(~m2.1*~x.6)>),
                                    <'Resp', $R.2, $I.2, 'g'^(~m2.1*~x.6), 'g'^(~m1.2*~ltkR.4)>)
                           ) @ #vk.7 )
                      case c_MAC
                      solve( !KU( KDF(<'g'^~m1.2, 'g'^(~m2.1*~x.6*inv(~ltkI.2)), $I.2, $R.2, 
                                       'g'^(~m1.2*~ltkR.4), 'g'^(~m2.1*~x.6)>)
                             ) @ #vk.8 )
                        case Sessk_reveal
                        by contradiction /* cyclic */
                      next
                        case c_KDF
                        solve( !KU( 'g'^(~m2.1*~x.6*inv(~ltkI.2)) ) @ #vk.21 )
                          case Init_1_case_1
                          solve( !KU( ~m1.3 ) @ #vk.35 )
                            case Ephk_reveal
                            solve( !KU( ~m2.2 ) @ #vk.38 )
                              case Ephk_reveal
                              solve( !KU( ~ltkI.4 ) @ #vk.40 )
                                case Ltk_reveal
                                solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                  case Init_1
                                  solve( !KU( ~ltkR.8 ) @ #vk.43 )
                                    case Ltk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                next
                                  case Init_2
                                  by contradiction /* cyclic */
                                next
                                  case c_exp
                                  solve( !KU( ~m1.2 ) @ #vk.43 )
                                    case Ephk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                qed
                              qed
                            qed
                          qed
                        next
                          case Init_1_case_2
                          solve( !KU( ~m2.2 ) @ #vk.35 )
                            case Ephk_reveal
                            solve( !KU( ~m1.3 ) @ #vk.40 )
                              case Ephk_reveal
                              solve( !KU( ~ltkI.4 ) @ #vk.41 )
                                case Ltk_reveal
                                solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                  case Init_1
                                  solve( !KU( ~ltkR.8 ) @ #vk.44 )
                                    case Ltk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                next
                                  case Init_2
                                  by contradiction /* cyclic */
                                next
                                  case c_exp
                                  solve( !KU( ~m1.2 ) @ #vk.44 )
                                    case Ephk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                qed
                              qed
                            qed
                          qed
                        next
                          case Init_2_case_1
                          solve( !KU( ~m1.3 ) @ #vk.38 )
                            case Ephk_reveal
                            solve( !KU( ~m2.2 ) @ #vk.41 )
                              case Ephk_reveal
                              solve( !KU( ~ltkI.4 ) @ #vk.43 )
                                case Ltk_reveal
                                solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                  case Init_1
                                  solve( !KU( ~ltkR.8 ) @ #vk.46 )
                                    case Ltk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                next
                                  case Init_2
                                  by contradiction /* cyclic */
                                next
                                  case c_exp
                                  solve( !KU( ~m1.2 ) @ #vk.46 )
                                    case Ephk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                qed
                              qed
                            qed
                          qed
                        next
                          case Init_2_case_2
                          solve( !KU( ~m2.2 ) @ #vk.38 )
                            case Ephk_reveal
                            solve( !KU( ~m1.3 ) @ #vk.43 )
                              case Ephk_reveal
                              solve( !KU( ~ltkI.4 ) @ #vk.44 )
                                case Ltk_reveal
                                solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                  case Init_1
                                  solve( !KU( ~ltkR.8 ) @ #vk.47 )
                                    case Ltk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                next
                                  case Init_2
                                  by contradiction /* cyclic */
                                next
                                  case c_exp
                                  solve( !KU( ~m1.2 ) @ #vk.47 )
                                    case Ephk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                qed
                              qed
                            qed
                          qed
                        next
                          case Register_pk
                          solve( !KU( ~m2.2 ) @ #vk.30 )
                            case Ephk_reveal
                            solve( !KU( ~ltkI.3 ) @ #vk.32 )
                              case Ltk_reveal
                              solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                case Init_1
                                solve( !KU( ~ltkR.6 ) @ #vk.35 )
                                  case Ltk_reveal
                                  by contradiction /* from formulas */
                                qed
                              next
                                case Init_2
                                by contradiction /* cyclic */
                              next
                                case c_exp
                                solve( !KU( ~m1.2 ) @ #vk.35 )
                                  case Ephk_reveal
                                  by contradiction /* from formulas */
                                qed
                              qed
                            qed
                          qed
                        next
                          case Resp_1_case_1
                          solve( !KU( ~ltkI.3 ) @ #vk.31 )
                            case Ltk_reveal
                            solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                              case Init_1
                              solve( !KU( ~ltkR.6 ) @ #vk.33 )
                                case Ltk_reveal
                                by contradiction /* from formulas */
                              qed
                            next
                              case Init_2
                              by contradiction /* cyclic */
                            next
                              case c_exp
                              solve( !KU( ~m1.2 ) @ #vk.33 )
                                case Ephk_reveal
                                by contradiction /* from formulas */
                              qed
                            qed
                          qed
                        next
                          case Resp_1_case_2
                          solve( !KU( ~m2.2 ) @ #vk.36 )
                            case Ephk_reveal
                            solve( !KU( ~m2.3 ) @ #vk.39 )
                              case Ephk_reveal
                              solve( !KU( ~ltkI.3 ) @ #vk.41 )
                                case Ltk_reveal
                                solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                  case Init_1
                                  solve( !KU( ~ltkR.8 ) @ #vk.45 )
                                    case Ltk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                next
                                  case Init_2
                                  by contradiction /* cyclic */
                                next
                                  case c_exp
                                  solve( !KU( ~m1.2 ) @ #vk.45 )
                                    case Ephk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                qed
                              qed
                            qed
                          qed
                        next
                          case Resp_1_case_3
                          solve( !KU( ~x.7 ) @ #vk.47 )
                            case Ltk_reveal
                            solve( !KU( ~ltkI.3 ) @ #vk.49 )
                              case Ltk_reveal
                              solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                case Init_1
                                solve( !KU( ~ltkR.6 ) @ #vk.51 )
                                  case Ltk_reveal
                                  by contradiction /* from formulas */
                                qed
                              next
                                case Init_2
                                by contradiction /* cyclic */
                              next
                                case c_exp
                                solve( !KU( ~m1.2 ) @ #vk.51 )
                                  case Ephk_reveal
                                  by contradiction /* from formulas */
                                qed
                              qed
                            qed
                          qed
                        next
                          case Resp_1_case_4
                          solve( !KU( ~m2.3 ) @ #vk.36 )
                            case Ephk_reveal
                            solve( !KU( ~m2.2 ) @ #vk.41 )
                              case Ephk_reveal
                              solve( !KU( ~ltkI.3 ) @ #vk.42 )
                                case Ltk_reveal
                                solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                  case Init_1
                                  solve( !KU( ~ltkR.8 ) @ #vk.46 )
                                    case Ltk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                next
                                  case Init_2
                                  by contradiction /* cyclic */
                                next
                                  case c_exp
                                  solve( !KU( ~m1.2 ) @ #vk.46 )
                                    case Ephk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                qed
                              qed
                            qed
                          qed
                        next
                          case Resp_1_case_5
                          solve( !KU( ~x.7 ) @ #vk.47 )
                            case Ltk_reveal
                            solve( !KU( ~ltkI.3 ) @ #vk.46 )
                              case Ltk_reveal
                              solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                case Init_1
                                solve( !KU( ~ltkR.6 ) @ #vk.49 )
                                  case Ltk_reveal
                                  by contradiction /* from formulas */
                                qed
                              next
                                case Init_2
                                by contradiction /* cyclic */
                              next
                                case c_exp
                                solve( !KU( ~m1.2 ) @ #vk.49 )
                                  case Ephk_reveal
                                  by contradiction /* from formulas */
                                qed
                              qed
                            qed
                          qed
                        next
                          case c_exp
                          solve( !KU( ~m2.1 ) @ #vk.31 )
                            case Ephk_reveal
                            solve( !KU( ~x.7 ) @ #vk.37 )
                              case Ltk_reveal
                              solve( !KU( ~ltkI.2 ) @ #vk.39 )
                                case Ltk_reveal
                                solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                  case Init_1
                                  solve( !KU( ~ltkR.6 ) @ #vk.41 )
                                    case Ltk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                next
                                  case Init_2
                                  by contradiction /* cyclic */
                                next
                                  case c_exp
                                  solve( !KU( ~m1.2 ) @ #vk.41 )
                                    case Ephk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                qed
                              qed
                            qed
                          qed
                        qed
                      qed
                    qed
                  next
                    case split_case_2
                    solve( !KU( MAC(KDF(<'g'^~m1.2, 'g'^(~m2.1*~x.6*inv(~ltkI.2)), $I.2, 
                                         $R.2, 'g'^(~m1.2*~ltkR.3), 'g'^(~m2.1*~x.6)>),
                                    <'Resp', $R.2, $I.2, 'g'^(~m2.1*~x.6), 'g'^(~m1.2*~ltkR.3)>)
                           ) @ #vk.7 )
                      case c_MAC
                      solve( !KU( KDF(<'g'^~m1.2, 'g'^(~m2.1*~x.6*inv(~ltkI.2)), $I.2, $R.2, 
                                       'g'^(~m1.2*~ltkR.3), 'g'^(~m2.1*~x.6)>)
                             ) @ #vk.8 )
                        case Sessk_reveal
                        by contradiction /* cyclic */
                      next
                        case c_KDF
                        solve( !KU( 'g'^(~m2.1*~x.6*inv(~ltkI.2)) ) @ #vk.21 )
                          case Init_1_case_1
                          solve( !KU( ~m1.3 ) @ #vk.35 )
                            case Ephk_reveal
                            solve( !KU( ~m2.2 ) @ #vk.38 )
                              case Ephk_reveal
                              solve( !KU( ~ltkI.4 ) @ #vk.40 )
                                case Ltk_reveal
                                solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                  case Init_1
                                  solve( !KU( ~ltkR.7 ) @ #vk.43 )
                                    case Ltk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                next
                                  case Init_2
                                  by contradiction /* cyclic */
                                next
                                  case c_exp
                                  solve( !KU( ~m1.2 ) @ #vk.43 )
                                    case Ephk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                qed
                              qed
                            qed
                          qed
                        next
                          case Init_1_case_2
                          solve( !KU( ~m2.2 ) @ #vk.35 )
                            case Ephk_reveal
                            solve( !KU( ~m1.3 ) @ #vk.40 )
                              case Ephk_reveal
                              solve( !KU( ~ltkI.4 ) @ #vk.41 )
                                case Ltk_reveal
                                solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                  case Init_1
                                  solve( !KU( ~ltkR.7 ) @ #vk.44 )
                                    case Ltk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                next
                                  case Init_2
                                  by contradiction /* cyclic */
                                next
                                  case c_exp
                                  solve( !KU( ~m1.2 ) @ #vk.44 )
                                    case Ephk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                qed
                              qed
                            qed
                          qed
                        next
                          case Init_2_case_1
                          solve( !KU( ~m1.3 ) @ #vk.38 )
                            case Ephk_reveal
                            solve( !KU( ~m2.2 ) @ #vk.41 )
                              case Ephk_reveal
                              solve( !KU( ~ltkI.4 ) @ #vk.43 )
                                case Ltk_reveal
                                solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                  case Init_1
                                  solve( !KU( ~ltkR.7 ) @ #vk.46 )
                                    case Ltk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                next
                                  case Init_2
                                  by contradiction /* cyclic */
                                next
                                  case c_exp
                                  solve( !KU( ~m1.2 ) @ #vk.46 )
                                    case Ephk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                qed
                              qed
                            qed
                          qed
                        next
                          case Init_2_case_2
                          solve( !KU( ~m2.2 ) @ #vk.38 )
                            case Ephk_reveal
                            solve( !KU( ~m1.3 ) @ #vk.43 )
                              case Ephk_reveal
                              solve( !KU( ~ltkI.4 ) @ #vk.44 )
                                case Ltk_reveal
                                solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                  case Init_1
                                  solve( !KU( ~ltkR.7 ) @ #vk.47 )
                                    case Ltk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                next
                                  case Init_2
                                  by contradiction /* cyclic */
                                next
                                  case c_exp
                                  solve( !KU( ~m1.2 ) @ #vk.47 )
                                    case Ephk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                qed
                              qed
                            qed
                          qed
                        next
                          case Register_pk
                          solve( !KU( ~m2.2 ) @ #vk.30 )
                            case Ephk_reveal
                            solve( !KU( ~ltkI.3 ) @ #vk.32 )
                              case Ltk_reveal
                              solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                case Init_1
                                solve( !KU( ~ltkR.5 ) @ #vk.35 )
                                  case Ltk_reveal
                                  by contradiction /* from formulas */
                                qed
                              next
                                case Init_2
                                by contradiction /* cyclic */
                              next
                                case c_exp
                                solve( !KU( ~m1.2 ) @ #vk.35 )
                                  case Ephk_reveal
                                  by contradiction /* from formulas */
                                qed
                              qed
                            qed
                          qed
                        next
                          case Resp_1_case_1
                          solve( !KU( ~ltkI.3 ) @ #vk.31 )
                            case Ltk_reveal
                            solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                              case Init_1
                              solve( !KU( ~ltkR.5 ) @ #vk.33 )
                                case Ltk_reveal
                                by contradiction /* from formulas */
                              qed
                            next
                              case Init_2
                              by contradiction /* cyclic */
                            next
                              case c_exp
                              solve( !KU( ~m1.2 ) @ #vk.33 )
                                case Ephk_reveal
                                by contradiction /* from formulas */
                              qed
                            qed
                          qed
                        next
                          case Resp_1_case_2
                          solve( !KU( ~m2.2 ) @ #vk.36 )
                            case Ephk_reveal
                            solve( !KU( ~m2.3 ) @ #vk.39 )
                              case Ephk_reveal
                              solve( !KU( ~ltkI.3 ) @ #vk.41 )
                                case Ltk_reveal
                                solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                  case Init_1
                                  solve( !KU( ~ltkR.7 ) @ #vk.45 )
                                    case Ltk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                next
                                  case Init_2
                                  by contradiction /* cyclic */
                                next
                                  case c_exp
                                  solve( !KU( ~m1.2 ) @ #vk.45 )
                                    case Ephk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                qed
                              qed
                            qed
                          qed
                        next
                          case Resp_1_case_3
                          solve( !KU( ~x.7 ) @ #vk.47 )
                            case Ltk_reveal
                            solve( !KU( ~ltkI.3 ) @ #vk.49 )
                              case Ltk_reveal
                              solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                case Init_1
                                solve( !KU( ~ltkR.5 ) @ #vk.51 )
                                  case Ltk_reveal
                                  by contradiction /* from formulas */
                                qed
                              next
                                case Init_2
                                by contradiction /* cyclic */
                              next
                                case c_exp
                                solve( !KU( ~m1.2 ) @ #vk.51 )
                                  case Ephk_reveal
                                  by contradiction /* from formulas */
                                qed
                              qed
                            qed
                          qed
                        next
                          case Resp_1_case_4
                          solve( !KU( ~m2.3 ) @ #vk.36 )
                            case Ephk_reveal
                            solve( !KU( ~m2.2 ) @ #vk.41 )
                              case Ephk_reveal
                              solve( !KU( ~ltkI.3 ) @ #vk.42 )
                                case Ltk_reveal
                                solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                  case Init_1
                                  solve( !KU( ~ltkR.7 ) @ #vk.46 )
                                    case Ltk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                next
                                  case Init_2
                                  by contradiction /* cyclic */
                                next
                                  case c_exp
                                  solve( !KU( ~m1.2 ) @ #vk.46 )
                                    case Ephk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                qed
                              qed
                            qed
                          qed
                        next
                          case Resp_1_case_5
                          solve( !KU( ~x.7 ) @ #vk.47 )
                            case Ltk_reveal
                            solve( !KU( ~ltkI.3 ) @ #vk.46 )
                              case Ltk_reveal
                              solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                case Init_1
                                solve( !KU( ~ltkR.5 ) @ #vk.49 )
                                  case Ltk_reveal
                                  by contradiction /* from formulas */
                                qed
                              next
                                case Init_2
                                by contradiction /* cyclic */
                              next
                                case c_exp
                                solve( !KU( ~m1.2 ) @ #vk.49 )
                                  case Ephk_reveal
                                  by contradiction /* from formulas */
                                qed
                              qed
                            qed
                          qed
                        next
                          case c_exp
                          solve( !KU( ~m2.1 ) @ #vk.31 )
                            case Ephk_reveal
                            solve( !KU( ~x.7 ) @ #vk.37 )
                              case Ltk_reveal
                              solve( !KU( ~ltkI.2 ) @ #vk.39 )
                                case Ltk_reveal
                                solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                                  case Init_1
                                  solve( !KU( ~ltkR.5 ) @ #vk.41 )
                                    case Ltk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                next
                                  case Init_2
                                  by contradiction /* cyclic */
                                next
                                  case c_exp
                                  solve( !KU( ~m1.2 ) @ #vk.41 )
                                    case Ephk_reveal
                                    by contradiction /* from formulas */
                                  qed
                                qed
                              qed
                            qed
                          qed
                        qed
                      qed
                    qed
                  qed
                next
                  case split_case_2
                  solve( splitEqs(1) )
                    case split_case_1
                    solve( !KU( MAC(KDF(<'g'^~m1.2, 'g'^~m2.1, $I.2, $R.2, 
                                         'g'^(~m1.2*~ltkR.4), 'g'^(~m2.1*~ltkI.2)>),
                                    <'Resp', $R.2, $I.2, 'g'^(~m2.1*~ltkI.2), 'g'^(~m1.2*~ltkR.4)>)
                           ) @ #vk.7 )
                      case c_MAC
                      solve( !KU( KDF(<'g'^~m1.2, 'g'^~m2.1, $I.2, $R.2, 'g'^(~m1.2*~ltkR.4), 
                                       'g'^(~m2.1*~ltkI.2)>)
                             ) @ #vk.8 )
                        case Sessk_reveal
                        by contradiction /* cyclic */
                      next
                        case c_KDF
                        solve( !KU( 'g'^~m1.2 ) @ #vk.19 )
                          case Init_1
                          solve( !KU( ~ltkR.5 ) @ #vk.30 )
                            case Ltk_reveal
                            solve( !KU( 'g'^~m2.1 ) @ #vk.21 )
                              case Resp_1
                              solve( !KU( ~x.6 ) @ #vk.33 )
                                case Ltk_reveal
                                by contradiction /* from formulas */
                              qed
                            next
                              case c_exp
                              solve( !KU( ~m2.1 ) @ #vk.32 )
                                case Ephk_reveal
                                by contradiction /* from formulas */
                              qed
                            qed
                          qed
                        next
                          case Init_2
                          by contradiction /* cyclic */
                        next
                          case c_exp
                          solve( !KU( ~m1.2 ) @ #vk.30 )
                            case Ephk_reveal
                            solve( !KU( 'g'^~m2.1 ) @ #vk.21 )
                              case Resp_1
                              solve( !KU( ~x.6 ) @ #vk.33 )
                                case Ltk_reveal
                                by contradiction /* from formulas */
                              qed
                            next
                              case c_exp
                              solve( !KU( ~m2.1 ) @ #vk.32 )
                                case Ephk_reveal
                                by contradiction /* from formulas */
                              qed
                            qed
                          qed
                        qed
                      qed
                    qed
                  next
                    case split_case_2
                    solve( !KU( KDF(<'g'^~m1.2, 'g'^~m2.1, $I.2, $R.2, 'g'^(~m1.2*~ltkR.3), 
                                     'g'^(~m2.1*~ltkI.2)>)
                           ) @ #vk )
                      case Sessk_reveal_case_1
                      by contradiction /* from formulas */
                    next
                      case Sessk_reveal_case_2
                      by contradiction /* from formulas */
                    next
                      case c_KDF
                      solve( !KU( 'g'^~m1.2 ) @ #vk.9 )
                        case Init_1
                        solve( !KU( ~ltkR.4 ) @ #vk.20 )
                          case Ltk_reveal
                          solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                            case Resp_1
                            solve( !KU( ~x.6 ) @ #vk.23 )
                              case Ltk_reveal
                              by contradiction /* from formulas */
                            qed
                          next
                            case c_exp
                            solve( !KU( ~m2.1 ) @ #vk.22 )
                              case Ephk_reveal
                              by contradiction /* from formulas */
                            qed
                          qed
                        qed
                      next
                        case Init_2
                        solve( !KU( ~ltkR.4 ) @ #vk.23 )
                          case Ltk_reveal
                          solve( !KU( 'g'^(~m2.1*~ltkI.3) ) @ #vk.20 )
                            case Init_1
                            solve( !KU( ~m2.2 ) @ #vk.28 )
                              case Ephk_reveal
                              by contradiction /* cyclic */
                            qed
                          next
                            case Init_2
                            solve( !KU( ~m2.2 ) @ #vk.31 )
                              case Ephk_reveal
                              by contradiction /* cyclic */
                            qed
                          next
                            case Register_pk
                            by contradiction /* cyclic */
                          next
                            case Resp_1_case_1
                            by contradiction /* cyclic */
                          next
                            case Resp_1_case_2
                            solve( !KU( ~m2.3 ) @ #vk.29 )
                              case Ephk_reveal
                              by contradiction /* cyclic */
                            qed
                          next
                            case c_exp
                            solve( !KU( ~m2.1 ) @ #vk.26 )
                              case Ephk_reveal
                              by contradiction /* cyclic */
                            qed
                          qed
                        qed
                      next
                        case c_exp
                        solve( !KU( ~m1.2 ) @ #vk.20 )
                          case Ephk_reveal
                          solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                            case Resp_1
                            solve( !KU( ~x.6 ) @ #vk.23 )
                              case Ltk_reveal
                              by contradiction /* from formulas */
                            qed
                          next
                            case c_exp
                            solve( !KU( ~m2.1 ) @ #vk.22 )
                              case Ephk_reveal
                              by contradiction /* from formulas */
                            qed
                          qed
                        qed
                      qed
                    qed
                  qed
                qed
              qed
            qed
          qed
        qed
      qed
    qed
  next
    case Resp_2
    solve( Resp_1( ~m2, $I, $R, YA, XB, tagA, key ) ▶₀ #i1 )
      case Resp_1
      solve( Sid( ss, C, D, ms ) @ #i4 )
        case Init_1
        solve( !Ltk( $I.1, ~ltkI ) ▶₁ #i4 )
          case Register_pk
          solve( !Pk( $R.1, 'g'^~ltkR.1 ) ▶₂ #i4 )
            case Register_pk
            solve( Match( ~m2, <$I.1, $R.1, 'Init', 'g'^(~m1*~ltkR.1)> ) @ #i5 )
              case Resp_1
              solve( splitEqs(1) )
                case split_case_1
                solve( !KU( KDF(<'g'^(~m1.1*~ltkR.4*inv(~ltkR.3)), 'g'^~m2.1, $I, $R, 
                                 'g'^(~m1.1*~ltkR.4), 'g'^(~m2.1*~x.1)>)
                       ) @ #vk )
                  case Sessk_reveal
                  by contradiction /* from formulas */
                next
                  case c_KDF
                  solve( !KU( 'g'^(~m1.1*~ltkR.4*inv(~ltkR.3)) ) @ #vk.9 )
                    case Init_1_case_1
                    solve( !KU( ~ltkR.6 ) @ #vk.20 )
                      case Ltk_reveal
                      solve( !KU( MAC(KDF(<'g'^(~m1.2*~ltkR.5*inv(~ltkR.6)), 'g'^~m2.1, $I.3, 
                                           $A.1, 'g'^(~m1.2*~ltkR.5), 'g'^(~m2.1*~x.1)>),
                                      <'Init', $I.3, $A.1, 'g'^(~m1.2*~ltkR.5), 'g'^(~m2.1*~x.1)>)
                             ) @ #vk.5 )
                        case c_MAC
                        solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                          case Resp_1
                          solve( !KU( ~x.5 ) @ #vk.33 )
                            case Ltk_reveal
                            by contradiction /* from formulas */
                          qed
                        next
                          case c_exp
                          solve( !KU( ~m2.1 ) @ #vk.32 )
                            case Ephk_reveal
                            by contradiction /* from formulas */
                          qed
                        qed
                      qed
                    qed
                  next
                    case Init_1_case_2
                    solve( !KU( ~ltkR.5 ) @ #vk.36 )
                      case Ltk_reveal
                      solve( !KU( ~ltkR.7 ) @ #vk.38 )
                        case Ltk_reveal
                        solve( !KU( MAC(KDF(<'g'^(~m1.2*~ltkR.5*inv(~ltkR.7)), 'g'^~m2.1, $I.3, 
                                             $A.2, 'g'^(~m1.2*~ltkR.5), 'g'^(~m2.1*~x.1)>),
                                        <'Init', $I.3, $A.2, 'g'^(~m1.2*~ltkR.5), 'g'^(~m2.1*~x.1)>)
                               ) @ #vk.5 )
                          case c_MAC
                          solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                            case Resp_1
                            solve( !KU( ~x.5 ) @ #vk.51 )
                              case Ltk_reveal
                              by contradiction /* from formulas */
                            qed
                          next
                            case c_exp
                            solve( !KU( ~m2.1 ) @ #vk.50 )
                              case Ephk_reveal
                              by contradiction /* from formulas */
                            qed
                          qed
                        qed
                      qed
                    qed
                  next
                    case Init_1_case_3
                    solve( !KU( ~m1.2 ) @ #vk.25 )
                      case Ephk_reveal
                      solve( !KU( ~m1.3 ) @ #vk.28 )
                        case Ephk_reveal
                        solve( !KU( ~ltkR.6 ) @ #vk.30 )
                          case Ltk_reveal
                          solve( !KU( MAC(KDF(<'g'^(~m1.3*~ltkR.8*inv(~ltkR.6)), 'g'^~m2.1, $I.5, 
                                               $A.1, 'g'^(~m1.3*~ltkR.8), 'g'^(~m2.1*~x.1)>),
                                          <'Init', $I.5, $A.1, 'g'^(~m1.3*~ltkR.8), 'g'^(~m2.1*~x.1)>)
                                 ) @ #vk.5 )
                            case c_MAC
                            solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                              case Resp_1
                              solve( !KU( ~x.5 ) @ #vk.43 )
                                case Ltk_reveal
                                by contradiction /* from formulas */
                              qed
                            next
                              case c_exp
                              solve( !KU( ~m2.1 ) @ #vk.42 )
                                case Ephk_reveal
                                by contradiction /* from formulas */
                              qed
                            qed
                          qed
                        qed
                      qed
                    qed
                  next
                    case Init_1_case_4
                    solve( !KU( ~ltkR.5 ) @ #vk.35 )
                      case Ltk_reveal
                      solve( !KU( ~ltkR.7 ) @ #vk.36 )
                        case Ltk_reveal
                        solve( !KU( MAC(KDF(<'g'^(~m1.2*~ltkR.5*inv(~ltkR.7)), 'g'^~m2.1, $I.3, 
                                             $A.2, 'g'^(~m1.2*~ltkR.5), 'g'^(~m2.1*~x.1)>),
                                        <'Init', $I.3, $A.2, 'g'^(~m1.2*~ltkR.5), 'g'^(~m2.1*~x.1)>)
                               ) @ #vk.5 )
                          case c_MAC
                          solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                            case Resp_1
                            solve( !KU( ~x.5 ) @ #vk.49 )
                              case Ltk_reveal
                              by contradiction /* from formulas */
                            qed
                          next
                            case c_exp
                            solve( !KU( ~m2.1 ) @ #vk.48 )
                              case Ephk_reveal
                              by contradiction /* from formulas */
                            qed
                          qed
                        qed
                      qed
                    qed
                  next
                    case Init_1_case_5
                    solve( !KU( ~m1.3 ) @ #vk.25 )
                      case Ephk_reveal
                      solve( !KU( ~m1.2 ) @ #vk.30 )
                        case Ephk_reveal
                        solve( !KU( ~ltkR.6 ) @ #vk.31 )
                          case Ltk_reveal
                          solve( !KU( MAC(KDF(<'g'^(~m1.3*~ltkR.8*inv(~ltkR.6)), 'g'^~m2.1, $I.4, 
                                               $A.1, 'g'^(~m1.3*~ltkR.8), 'g'^(~m2.1*~x.1)>),
                                          <'Init', $I.4, $A.1, 'g'^(~m1.3*~ltkR.8), 'g'^(~m2.1*~x.1)>)
                                 ) @ #vk.5 )
                            case c_MAC
                            solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                              case Resp_1
                              solve( !KU( ~x.5 ) @ #vk.44 )
                                case Ltk_reveal
                                by contradiction /* from formulas */
                              qed
                            next
                              case c_exp
                              solve( !KU( ~m2.1 ) @ #vk.43 )
                                case Ephk_reveal
                                by contradiction /* from formulas */
                              qed
                            qed
                          qed
                        qed
                      qed
                    qed
                  next
                    case Init_2_case_1
                    solve( !KU( ~ltkR.6 ) @ #vk.23 )
                      case Ltk_reveal
                      solve( !KU( MAC(KDF(<'g'^(~m1.2*~ltkR.5*inv(~ltkR.6)), 'g'^~m2.1, $I.3, 
                                           $A.1, 'g'^(~m1.2*~ltkR.5), 'g'^(~m2.1*~x.1)>),
                                      <'Init', $I.3, $A.1, 'g'^(~m1.2*~ltkR.5), 'g'^(~m2.1*~x.1)>)
                             ) @ #vk.5 )
                        case c_MAC
                        solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                          case Resp_1
                          solve( !KU( ~x.6 ) @ #vk.36 )
                            case Ltk_reveal
                            by contradiction /* from formulas */
                          qed
                        next
                          case c_exp
                          solve( !KU( ~m2.1 ) @ #vk.35 )
                            case Ephk_reveal
                            by contradiction /* from formulas */
                          qed
                        qed
                      qed
                    qed
                  next
                    case Init_2_case_2
                    solve( !KU( ~ltkR.5 ) @ #vk.39 )
                      case Ltk_reveal
                      solve( !KU( ~ltkR.7 ) @ #vk.41 )
                        case Ltk_reveal
                        solve( !KU( MAC(KDF(<'g'^(~m1.2*~ltkR.5*inv(~ltkR.7)), 'g'^~m2.1, $I.3, 
                                             $A.2, 'g'^(~m1.2*~ltkR.5), 'g'^(~m2.1*~x.1)>),
                                        <'Init', $I.3, $A.2, 'g'^(~m1.2*~ltkR.5), 'g'^(~m2.1*~x.1)>)
                               ) @ #vk.5 )
                          case c_MAC
                          solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                            case Resp_1
                            solve( !KU( ~x.6 ) @ #vk.54 )
                              case Ltk_reveal
                              by contradiction /* from formulas */
                            qed
                          next
                            case c_exp
                            solve( !KU( ~m2.1 ) @ #vk.53 )
                              case Ephk_reveal
                              by contradiction /* from formulas */
                            qed
                          qed
                        qed
                      qed
                    qed
                  next
                    case Init_2_case_3
                    solve( !KU( ~m1.2 ) @ #vk.28 )
                      case Ephk_reveal
                      solve( !KU( ~m1.3 ) @ #vk.31 )
                        case Ephk_reveal
                        solve( !KU( ~ltkR.6 ) @ #vk.33 )
                          case Ltk_reveal
                          solve( !KU( MAC(KDF(<'g'^(~m1.3*~ltkR.8*inv(~ltkR.6)), 'g'^~m2.1, $I.5, 
                                               $A.1, 'g'^(~m1.3*~ltkR.8), 'g'^(~m2.1*~x.1)>),
                                          <'Init', $I.5, $A.1, 'g'^(~m1.3*~ltkR.8), 'g'^(~m2.1*~x.1)>)
                                 ) @ #vk.5 )
                            case c_MAC
                            solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                              case Resp_1
                              solve( !KU( ~x.6 ) @ #vk.46 )
                                case Ltk_reveal
                                by contradiction /* from formulas */
                              qed
                            next
                              case c_exp
                              solve( !KU( ~m2.1 ) @ #vk.45 )
                                case Ephk_reveal
                                by contradiction /* from formulas */
                              qed
                            qed
                          qed
                        qed
                      qed
                    qed
                  next
                    case Init_2_case_4
                    solve( !KU( ~ltkR.5 ) @ #vk.38 )
                      case Ltk_reveal
                      solve( !KU( ~ltkR.7 ) @ #vk.39 )
                        case Ltk_reveal
                        solve( !KU( MAC(KDF(<'g'^(~m1.2*~ltkR.5*inv(~ltkR.7)), 'g'^~m2.1, $I.3, 
                                             $A.2, 'g'^(~m1.2*~ltkR.5), 'g'^(~m2.1*~x.1)>),
                                        <'Init', $I.3, $A.2, 'g'^(~m1.2*~ltkR.5), 'g'^(~m2.1*~x.1)>)
                               ) @ #vk.5 )
                          case c_MAC
                          solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                            case Resp_1
                            solve( !KU( ~x.6 ) @ #vk.52 )
                              case Ltk_reveal
                              by contradiction /* from formulas */
                            qed
                          next
                            case c_exp
                            solve( !KU( ~m2.1 ) @ #vk.51 )
                              case Ephk_reveal
                              by contradiction /* from formulas */
                            qed
                          qed
                        qed
                      qed
                    qed
                  next
                    case Init_2_case_5
                    solve( !KU( ~m1.3 ) @ #vk.28 )
                      case Ephk_reveal
                      solve( !KU( ~m1.2 ) @ #vk.33 )
                        case Ephk_reveal
                        solve( !KU( ~ltkR.6 ) @ #vk.34 )
                          case Ltk_reveal
                          solve( !KU( MAC(KDF(<'g'^(~m1.3*~ltkR.8*inv(~ltkR.6)), 'g'^~m2.1, $I.4, 
                                               $A.1, 'g'^(~m1.3*~ltkR.8), 'g'^(~m2.1*~x.1)>),
                                          <'Init', $I.4, $A.1, 'g'^(~m1.3*~ltkR.8), 'g'^(~m2.1*~x.1)>)
                                 ) @ #vk.5 )
                            case c_MAC
                            solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                              case Resp_1
                              solve( !KU( ~x.6 ) @ #vk.47 )
                                case Ltk_reveal
                                by contradiction /* from formulas */
                              qed
                            next
                              case c_exp
                              solve( !KU( ~m2.1 ) @ #vk.46 )
                                case Ephk_reveal
                                by contradiction /* from formulas */
                              qed
                            qed
                          qed
                        qed
                      qed
                    qed
                  next
                    case Register_pk
                    solve( !KU( ~m1.2 ) @ #vk.20 )
                      case Ephk_reveal
                      solve( !KU( ~ltkR.5 ) @ #vk.22 )
                        case Ltk_reveal
                        solve( !KU( MAC(KDF(<'g'^(~m1.2*~ltkR.6*inv(~ltkR.5)), 'g'^~m2.1, $I.3, 
                                             $A.2, 'g'^(~m1.2*~ltkR.6), 'g'^(~m2.1*~x.1)>),
                                        <'Init', $I.3, $A.2, 'g'^(~m1.2*~ltkR.6), 'g'^(~m2.1*~x.1)>)
                               ) @ #vk.5 )
                          case c_MAC
                          solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                            case Resp_1
                            solve( !KU( ~x.5 ) @ #vk.35 )
                              case Ltk_reveal
                              by contradiction /* from formulas */
                            qed
                          next
                            case c_exp
                            solve( !KU( ~m2.1 ) @ #vk.34 )
                              case Ephk_reveal
                              by contradiction /* from formulas */
                            qed
                          qed
                        qed
                      qed
                    qed
                  next
                    case Resp_1_case_1
                    solve( !KU( ~m2.2 ) @ #vk.26 )
                      case Ephk_reveal
                      solve( !KU( ~m1.2 ) @ #vk.29 )
                        case Ephk_reveal
                        solve( !KU( ~ltkR.7 ) @ #vk.31 )
                          case Ltk_reveal
                          solve( !KU( MAC(KDF(<'g'^(~m1.2*~ltkR.9*inv(~ltkR.7)), 'g'^~m2.1, $I.5, 
                                               $A.1, 'g'^(~m1.2*~ltkR.9), 'g'^(~m2.1*~x.1)>),
                                          <'Init', $I.5, $A.1, 'g'^(~m1.2*~ltkR.9), 'g'^(~m2.1*~x.1)>)
                                 ) @ #vk.5 )
                            case c_MAC
                            solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                              case Resp_1
                              solve( !KU( ~x.6 ) @ #vk.45 )
                                case Ltk_reveal
                                by contradiction /* from formulas */
                              qed
                            next
                              case c_exp
                              solve( !KU( ~m2.1 ) @ #vk.44 )
                                case Ephk_reveal
                                by contradiction /* from formulas */
                              qed
                            qed
                          qed
                        qed
                      qed
                    qed
                  next
                    case Resp_1_case_2
                    solve( !KU( ~m1.2 ) @ #vk.26 )
                      case Ephk_reveal
                      solve( !KU( ~m2.2 ) @ #vk.31 )
                        case Ephk_reveal
                        solve( !KU( ~ltkR.7 ) @ #vk.32 )
                          case Ltk_reveal
                          solve( !KU( MAC(KDF(<'g'^(~m1.2*~x.5*inv(~ltkR.7)), 'g'^~m2.1, $I.4, 
                                               $A.1, 'g'^(~m1.2*~x.5), 'g'^(~m2.1*~x.1)>),
                                          <'Init', $I.4, $A.1, 'g'^(~m1.2*~x.5), 'g'^(~m2.1*~x.1)>)
                                 ) @ #vk.5 )
                            case c_MAC
                            solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                              case Resp_1
                              solve( !KU( ~x.6 ) @ #vk.46 )
                                case Ltk_reveal
                                by contradiction /* from formulas */
                              qed
                            next
                              case c_exp
                              solve( !KU( ~m2.1 ) @ #vk.45 )
                                case Ephk_reveal
                                by contradiction /* from formulas */
                              qed
                            qed
                          qed
                        qed
                      qed
                    qed
                  next
                    case c_exp
                    solve( !KU( ~m1.1 ) @ #vk.21 )
                      case Ephk_reveal
                      solve( !KU( ~ltkR.5 ) @ #vk.26 )
                        case Ltk_reveal
                        solve( !KU( ~ltkR.3 ) @ #vk.28 )
                          case Ltk_reveal
                          solve( !KU( MAC(KDF(<'g'^(~m1.1*~ltkR.5*inv(~ltkR.3)), 'g'^~m2.1, $I.3, 
                                               $A.2, 'g'^(~m1.1*~ltkR.5), 'g'^(~m2.1*~x.1)>),
                                          <'Init', $I.3, $A.2, 'g'^(~m1.1*~ltkR.5), 'g'^(~m2.1*~x.1)>)
                                 ) @ #vk.5 )
                            case c_MAC
                            solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                              case Resp_1
                              solve( !KU( ~x.5 ) @ #vk.41 )
                                case Ltk_reveal
                                by contradiction /* from formulas */
                              qed
                            next
                              case c_exp
                              solve( !KU( ~m2.1 ) @ #vk.40 )
                                case Ephk_reveal
                                by contradiction /* from formulas */
                              qed
                            qed
                          qed
                        qed
                      qed
                    qed
                  qed
                qed
              next
                case split_case_2
                solve( !KU( KDF(<'g'^~m1.1, 'g'^~m2.1, $I, $R, 'g'^(~m1.1*~ltkR.3), 
                                 'g'^(~m2.1*~x.1)>)
                       ) @ #vk )
                  case Sessk_reveal_case_1
                  by contradiction /* from formulas */
                next
                  case Sessk_reveal_case_2
                  by contradiction /* from formulas */
                next
                  case c_KDF
                  solve( !KU( MAC(KDF(<'g'^~m1.1, 'g'^~m2.1, $I, $R, 'g'^(~m1.1*~ltkR.3), 
                                       'g'^(~m2.1*~x.1)>),
                                  <'Init', $I, $R, 'g'^(~m1.1*~ltkR.3), 'g'^(~m2.1*~x.1)>)
                         ) @ #vk.5 )
                    case Init_2
                    solve( !KU( 'g'^~m1.1 ) @ #vk.9 )
                      case Init_1
                      solve( !KU( ~ltkR.5 ) @ #vk.23 )
                        case Ltk_reveal
                        solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                          case Resp_1
                          solve( !KU( ~x.5 ) @ #vk.26 )
                            case Ltk_reveal
                            by contradiction /* from formulas */
                          qed
                        next
                          case c_exp
                          solve( !KU( ~m2.1 ) @ #vk.25 )
                            case Ephk_reveal
                            by contradiction /* from formulas */
                          qed
                        qed
                      qed
                    next
                      case Init_2
                      solve( !KU( ~ltkR.5 ) @ #vk.26 )
                        case Ltk_reveal
                        solve( !KU( 'g'^(~m2.1*~ltkI.2) ) @ #vk.23 )
                          case Init_1
                          solve( !KU( ~m2.2 ) @ #vk.31 )
                            case Ephk_reveal
                            by contradiction /* cyclic */
                          qed
                        next
                          case Init_2
                          solve( !KU( ~m2.2 ) @ #vk.34 )
                            case Ephk_reveal
                            by contradiction /* cyclic */
                          qed
                        next
                          case Register_pk
                          by contradiction /* cyclic */
                        next
                          case Resp_1_case_1
                          by contradiction /* cyclic */
                        next
                          case Resp_1_case_2
                          solve( !KU( ~m2.3 ) @ #vk.32 )
                            case Ephk_reveal
                            by contradiction /* cyclic */
                          qed
                        next
                          case c_exp
                          solve( !KU( ~m2.1 ) @ #vk.29 )
                            case Ephk_reveal
                            by contradiction /* cyclic */
                          qed
                        qed
                      qed
                    next
                      case c_exp
                      solve( !KU( ~m1.1 ) @ #vk.23 )
                        case Ephk_reveal
                        solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                          case Resp_1
                          solve( !KU( ~x.5 ) @ #vk.26 )
                            case Ltk_reveal
                            by contradiction /* from formulas */
                          qed
                        next
                          case c_exp
                          solve( !KU( ~m2.1 ) @ #vk.25 )
                            case Ephk_reveal
                            by contradiction /* from formulas */
                          qed
                        qed
                      qed
                    qed
                  next
                    case c_MAC
                    solve( !KU( 'g'^~m1.1 ) @ #vk.9 )
                      case Init_1
                      solve( !KU( ~ltkR.4 ) @ #vk.30 )
                        case Ltk_reveal
                        solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                          case Resp_1
                          solve( !KU( ~x.5 ) @ #vk.33 )
                            case Ltk_reveal
                            by contradiction /* from formulas */
                          qed
                        next
                          case c_exp
                          solve( !KU( ~m2.1 ) @ #vk.32 )
                            case Ephk_reveal
                            by contradiction /* from formulas */
                          qed
                        qed
                      qed
                    next
                      case Init_2
                      solve( !KU( ~ltkR.4 ) @ #vk.33 )
                        case Ltk_reveal
                        solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                          case Resp_1
                          solve( !KU( ~x.6 ) @ #vk.36 )
                            case Ltk_reveal
                            by contradiction /* from formulas */
                          qed
                        next
                          case c_exp
                          solve( !KU( ~m2.1 ) @ #vk.35 )
                            case Ephk_reveal
                            by contradiction /* from formulas */
                          qed
                        qed
                      qed
                    next
                      case c_exp
                      solve( !KU( ~m1.1 ) @ #vk.30 )
                        case Ephk_reveal
                        solve( !KU( 'g'^~m2.1 ) @ #vk.11 )
                          case Resp_1
                          solve( !KU( ~x.5 ) @ #vk.33 )
                            case Ltk_reveal
                            by contradiction /* from formulas */
                          qed
                        next
                          case c_exp
                          solve( !KU( ~m2.1 ) @ #vk.32 )
                            case Ephk_reveal
                            by contradiction /* from formulas */
                          qed
                        qed
                      qed
                    qed
                  qed
                qed
              qed
            qed
          qed
        qed
      next
        case Init_2
        solve( Init_1( ~m1, $I.1, $R.1, ~ltkI, X, XB.1 ) ▶₀ #i4 )
          case Init_1
          solve( Match( ~m2, <$I.1, $R.1, 'Init', 'g'^(~m1*~ltkR.1), YA.1>
                 ) @ #i5 )
            case Resp_1
            solve( !KU( KDF(<<'g'^(~m1.1*~ltkR.3), YA.2>^inv(~ltkR), 'g'^~m2.1, $I, 
                             $R, <'g'^(~m1.1*~ltkR.3), YA.2>, 'g'^(~m2.1*~x.1)>)
                   ) @ #vk )
              case Sessk_reveal
              by contradiction /* from formulas */
            next
              case c_KDF
              solve( !KU( MAC(KDF(<<'g'^(~m1.1*~ltkR.3), YA.2>^inv(~ltkR), 'g'^~m2.1, 
                                   $I, $R, <'g'^(~m1.1*~ltkR.3), YA.2>, 'g'^(~m2.1*~x.1)>),
                              <'Init', $I, $R, <'g'^(~m1.1*~ltkR.3), YA.2>, 'g'^(~m2.1*~x.1)>)
                     ) @ #vk.5 )
                case c_MAC
                solve( !KU( MAC(KDF(<'g'^~m1.1, z.1, $I, $R, 'g'^(~m1.1*~ltkR.3), YA.2>),
                                <'Resp', $R, $I, YA.2, 'g'^(~m1.1*~ltkR.3)>)
                       ) @ #vk.9 )
                  case Resp_1
                  solve( !KU( <'g'^(~m1.1*~ltkR.5), 'g'^(~ltkI.1*~m2.2)>^inv(~ltkR)
                         ) @ #vk.16 )
                    case c_exp
                    solve( !KU( ~ltkR ) @ #vk.45 )
                      case Ltk_reveal
                      solve( !KU( 'g'^~m2.1 ) @ #vk.18 )
                        case Resp_1
                        solve( !KU( ~x.4 ) @ #vk.48 )
                          case Ltk_reveal
                          by contradiction /* from formulas */
                        qed
                      next
                        case c_exp
                        solve( !KU( ~m2.1 ) @ #vk.47 )
                          case Ephk_reveal
                          by contradiction /* from formulas */
                        qed
                      qed
                    qed
                  qed
                next
                  case c_MAC
                  solve( !KU( <'g'^(~m1.1*~ltkR.3), YA.2>^inv(~ltkR) ) @ #vk.16 )
                    case c_exp
                    solve( !KU( ~ltkR ) @ #vk.54 )
                      case Ltk_reveal
                      solve( !KU( 'g'^~m2.1 ) @ #vk.18 )
                        case Resp_1
                        solve( !KU( ~x.3 ) @ #vk.57 )
                          case Ltk_reveal
                          by contradiction /* from formulas */
                        qed
                      next
                        case c_exp
                        solve( !KU( ~m2.1 ) @ #vk.56 )
                          case Ephk_reveal
                          by contradiction /* from formulas */
                        qed
                      qed
                    qed
                  qed
                qed
              qed
            qed
          qed
        qed
      next
        case Resp_1
        solve( !Ltk( $R.1, ~ltkR.1 ) ▶₂ #i4 )
          case Register_pk
          solve( !Pk( $I.1, 'g'^~x.2 ) ▶₃ #i4 )
            case Register_pk
            solve( Match( ~m2, <$R.1, $I.1, 'Resp', 'g'^(~m2.1*~x.2), XB.1> ) @ #i5 )
              case Init_2
              by solve( Init_1( ~m1, $I.2, $R.2, ~ltkI, X, XB.2 ) ▶₀ #i5 )
            qed
          qed
        qed
      qed
    qed
  qed
next
  case case_2
  solve( Accept( s, A, B, x ) @ #i1 )
    case Init_2
    solve( Init_1( ~m1, $I, $R, ~ltkI, X, XB ) ▶₀ #i1 )
      case Init_1
      solve( !KU( MAC(KDF(<'g'^~m1, z, $I, $R, 'g'^(~ltkR*~m1), YA>),
                      <'Resp', $R, $I, YA, 'g'^(~ltkR*~m1)>)
             ) @ #vk.3 )
        case Resp_1
        solve( !KU( KDF(<'g'^~m1, 'g'^~m2, $I, $R, 'g'^(~m1*~ltkR.1), 
                         'g'^(~m2*~ltkI.1)>)
               ) @ #vk )
          case Sessk_reveal_case_1
          by contradiction /* from formulas */
        next
          case Sessk_reveal_case_2
          by contradiction /* from formulas */
        next
          case c_KDF
          solve( !KU( 'g'^~m1 ) @ #vk.6 )
            case Init_1
            solve( !KU( ~ltkR.2 ) @ #vk.17 )
              case Ltk_reveal
              solve( !KU( 'g'^~m2 ) @ #vk.8 )
                case Resp_1
                solve( !KU( ~x.2 ) @ #vk.20 )
                  case Ltk_reveal
                  by contradiction /* from formulas */
                qed
              next
                case c_exp
                solve( !KU( ~m2 ) @ #vk.19 )
                  case Ephk_reveal
                  by contradiction /* from formulas */
                qed
              qed
            qed
          next
            case Init_2
            by contradiction /* cyclic */
          next
            case c_exp
            solve( !KU( ~m1 ) @ #vk.17 )
              case Ephk_reveal
              by contradiction /* from formulas */
            qed
          qed
        qed
      next
        case c_MAC
        solve( !KU( KDF(<'g'^~m1, z, $I, $R, 'g'^(~ltkR*~m1), YA>) ) @ #vk.4 )
          case Sessk_reveal_case_1
          by contradiction /* cyclic */
        next
          case Sessk_reveal_case_2
          by contradiction /* from formulas */
        next
          case c_KDF
          solve( !KU( 'g'^~m1 ) @ #vk.15 )
            case Init_1
            solve( !KU( ~ltkR.1 ) @ #vk.26 )
              case Ltk_reveal
              by contradiction /* from formulas */
            qed
          next
            case Init_2
            by contradiction /* cyclic */
          next
            case c_exp
            solve( !KU( ~m1 ) @ #vk.26 )
              case Ephk_reveal
              by contradiction /* from formulas */
            qed
          qed
        qed
      qed
    qed
  next
    case Resp_2
    solve( Resp_1( ~m2, $I, $R, YA, XB, tagA, key ) ▶₀ #i1 )
      case Resp_1
      solve( !KU( KDF(<z, 'g'^~m2, $I, $R, XB, 'g'^(~m2*~x.1)>) ) @ #vk )
        case Sessk_reveal_case_1
        by contradiction /* from formulas */
      next
        case Sessk_reveal_case_2
        by contradiction /* from formulas */
      next
        case c_KDF
        solve( !KU( MAC(KDF(<z, 'g'^~m2, $I, $R, XB, 'g'^(~m2*~x.1)>),
                        <'Init', $I, $R, XB, 'g'^(~m2*~x.1)>)
               ) @ #vk.5 )
          case Init_2
          solve( !KU( 'g'^~m2 ) @ #vk.10 )
            case Resp_1
            solve( !KU( ~x.2 ) @ #vk.23 )
              case Ltk_reveal
              solve( !KU( 'g'^~m1 ) @ #vk.8 )
                case Init_1
                solve( !KU( ~ltkR.4 ) @ #vk.25 )
                  case Ltk_reveal
                  by contradiction /* from formulas */
                qed
              next
                case Init_2
                by contradiction /* cyclic */
              next
                case c_exp
                solve( !KU( ~m1 ) @ #vk.25 )
                  case Ephk_reveal
                  by contradiction /* from formulas */
                qed
              qed
            qed
          next
            case c_exp
            solve( !KU( ~m2 ) @ #vk.22 )
              case Ephk_reveal
              by contradiction /* from formulas */
            qed
          qed
        next
          case c_MAC
          solve( !KU( 'g'^~m2 ) @ #vk.10 )
            case Resp_1
            solve( !KU( ~x.2 ) @ #vk.30 )
              case Ltk_reveal
              by contradiction /* from formulas */
            qed
          next
            case c_exp
            solve( !KU( ~m2 ) @ #vk.29 )
              case Ephk_reveal
              by contradiction /* from formulas */
            qed
          qed
        qed
      qed
    qed
  qed
qed













/*
WARNING: the following wellformedness checks failed!

Message Derivation Checks
=========================

  The variables of the following rule(s) are not derivable from their premises, you may be performing unintended pattern matching.

Rule Init_1: 
Failed to derive Variable(s): ~ltkR

Rule Resp_1: 
Failed to derive Variable(s): ~ltkI
*/

/*
Generated from:
Tamarin version 1.11.0
Maude version 3.2.1
Git revision: d8e8266fc8aa702ff3c4d08608a7fbbe124eea65, branch: cyclic-squashed
Compiled at: 2024-11-27 09:37:37.786154 UTC
*/

end
/* Output

==============================================================================
summary of summaries:

analyzed: examples/csf12/DH2_original.spthy

  output:          examples/csf12/DH2_original.spthy.tmp
  processing time: 6.88s
  
  WARNING: 1 wellformedness check failed!
           The analysis results might be wrong!
  
  KAS_key_secrecy (all-traces): verified (501 steps)

==============================================================================
*/
